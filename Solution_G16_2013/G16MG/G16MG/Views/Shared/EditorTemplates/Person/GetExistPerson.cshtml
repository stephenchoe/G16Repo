@model G16_2013.Models.MemberModel.PersonViewModel


<div id="GetPersonDiv">
    <div class="form-group  has-success col-md-5">

        <label class="control-label " for="GetPersonInput">請在此輸入現有人員姓名，系統將顯示此人員基本資訊！</label>
        <input type="text" class="form-control" placeholder="現有人員姓名" id="GetPersonInput" />


    </div>
    <div id="waitdiv" class="col-md-12" style="display: none">
        <img src="~/Content/images/ajaxloader-g.gif" />
    </div>

   @if (Model != null)
   { 
    @Html.DisplayForModel("Person")
        <hr />
        @Html.DisplayFor(m => m.ContactInfoView, "PersonContactInfo")
   }
    
  
       
 


</div>
@using (Html.BeginScriptContext())
{
    Html.AddScriptBlock(
        @<script type="text/javascript">
    $(document).ready(function () {
        bookGetPersonInput();
    })


    function bookGetPersonInput() {
        var autocompleteUrl = '@Url.Action("FindPerson", "Person")';
                $("#GetPersonInput").autocomplete({
                    source: autocompleteUrl,
                    minLength: 0,
                    select: function (event, ui) {
                       
                        $("#waitdiv").css("display", "block");
                        GetPersonDetails(ui.item.id);

                    }
                });
            }
          
            function GetPersonDetails(id) {
                $.ajax({
                    type: "GET",
                    cache: false,
                    url: '/Person/GetPersonViewWithContactInfo?id=' + id + '',                 
                    dataType: 'html',
                    async: true,
                    success: function (data) {
                        // this assumes that the data-ajax-mode is always "replace":
                       
                        $("#waitdiv").css("display", "none");
                        $("#GetPersonDiv").replaceWith(data);

                        $("#ExsitPersonId").val(id);
                        bookGetPersonInput();
                        $("#CreateButtonPanel").css("display", "inline");
                    },
                    error: function () {
                        alert('載入失敗!');
                    }
                });
            }

        </script>
, true);
}